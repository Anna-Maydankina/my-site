{% extends 'base.html' %}
{% load static %}


{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/bookmarks.css' %}">
{% endblock %}

{% block content %}
<section class="py-3 py-md-5 mobile-padding">
    <div class="container-fluid">
        <div class="row justify-content-center">
            <div class="col-12 col-md-10">
                <h1 class="h2 mb-4 text-center page-title">üìö –ú–æ–∏ –∑–∞–∫–ª–∞–¥–∫–∏</h1>
                
                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–∫–ª–∞–¥–æ–∫ -->
                <div class="card mb-4 bookmark-stats-card">
                    <div class="card-header bookmark-stats-header">
                        <div class="d-flex justify-content-between align-items-center flex-wrap">
                            <div>
                                <h4 class="mb-2">üìñ –í–∞—à–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∏—Å—Ç–æ—Ä–∏–∏</h4>
                                <p class="mb-0 opacity-75">–í—Å–µ–≥–æ –∑–∞–∫–ª–∞–¥–æ–∫: <strong>{{ total_bookmarks }}</strong></p>
                            </div>
                            {% if total_bookmarks > 0 %}
                            <button type="button" class="btn btn-sm mt-2 mt-md-0 clear-all-btn" 
                                    data-bs-toggle="modal" data-bs-target="#clearModal">
                                üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ
                            </button>
                            {% endif %}
                        </div>
                    </div>
                    
                    {% if total_bookmarks == 0 %}
                    <!-- –ü—É—Å—Ç—ã–µ –∑–∞–∫–ª–∞–¥–∫–∏ -->
                    <div class="card-body text-center p-5 empty-bookmarks">
                        <div class="mb-4">
                            <i class="bi bi-bookmark-star display-1 text-muted mb-3"></i>
                            <h4 class="h4 mb-3">üòî –ù–µ—Ç –∑–∞–∫–ª–∞–¥–æ–∫</h4>
                            <p class="text-muted mb-4">
                                –í—ã –µ—â–µ –Ω–µ –¥–æ–±–∞–≤–∏–ª–∏ –Ω–∏ –æ–¥–Ω–æ–≥–æ —Ñ–∞–Ω—Ñ–∏–∫–∞ –≤ –∑–∞–∫–ª–∞–¥–∫–∏
                            </p>
                        </div>
                        
                        <div class="mb-4">
                            <p class="text-dark mb-3 fw-bold">–ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –∑–∞–∫–ª–∞–¥–∫–∏?</p>
                            <ul class="instructions-list">
                                <li>‚Ä¢ –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É "–í –∑–∞–∫–ª–∞–¥–∫–∏" –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ñ–∞–Ω—Ñ–∏–∫–∞</li>
                                <li>‚Ä¢ –ù–∞–∂–∏–º–∞–π—Ç–µ –Ω–∞ –∑–Ω–∞—á–æ–∫ –∑–∞–∫–ª–∞–¥–∫–∏ üîñ —Ä—è–¥–æ–º —Å —Ñ–∞–Ω—Ñ–∏–∫–∞–º–∏</li>
                                <li>‚Ä¢ –í—ã –º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–ª—è—Ç—å –≤ –∑–∞–∫–ª–∞–¥–∫–∏ —Ç–æ–ª—å–∫–æ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∞–Ω—Ñ–∏–∫–∏</li>
                            </ul>
                        </div>
                        
                        <div class="mt-4">
                            <a href="{% url 'new_fanfics' %}" class="btn me-2 mb-2 new-fanfics-btn">
                                üìö –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–æ–≤—ã–µ —Ñ–∞–Ω—Ñ–∏–∫–∏
                            </a>
                            <a href="{% url 'popular_fanfics' %}" class="btn mb-2 popular-fanfics-btn">
                                üî• –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∏—Å—Ç–æ—Ä–∏–∏
                            </a>
                        </div>
                    </div>
                    {% endif %}
                </div>
                
                <!-- –°–ø–∏—Å–æ–∫ –∑–∞–∫–ª–∞–¥–æ–∫ -->
                {% if bookmarks %}
                {% for bookmark in bookmarks %}
                <div class="story-card mb-4 bookmark-card">
                    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å –¥–∞—Ç–æ–π –¥–æ–±–∞–≤–ª–µ–Ω–∏—è -->
                    <div class="d-flex justify-content-between align-items-start mb-2 bookmark-header">
                        <h3 class="story-title mb-0">{{ bookmark.fanfic.title }}</h3>
                        <div class="text-end">
                            <small class="bookmark-date">
                                <i class="bi bi-bookmark-star-fill bookmark-icon"></i>
                                {{ bookmark.created_at|date:"d.m.Y" }}
                            </small>
                        </div>
                    </div>
                    
                    <!-- –ê–≤—Ç–æ—Ä -->
                    <div class="story-author mb-2">
                        –ê–≤—Ç–æ—Ä: 
                        <a href="{% url 'user_fanfics' bookmark.fanfic.author.username %}" 
                           class="author-link">
                            {{ bookmark.fanfic.author.username }}
                        </a>
                    </div>
                    
                    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ñ–∞–Ω—Ñ–∏–∫–∞ -->
                    <div class="bookmark-stats">
                        <span>
                            <i class="bi bi-eye"></i> {{ bookmark.fanfic.views_count }} –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤
                        </span>
                        <span>
                            <i class="bi bi-calendar"></i> {{ bookmark.fanfic.created_at|date:"d.m.Y" }}
                        </span>
                        {% if bookmark.fanfic.is_popular %}
                        <span class="popular-badge">
                            <i class="bi bi-fire"></i> –ü–æ–ø—É–ª—è—Ä–Ω—ã–π
                        </span>
                        {% endif %}
                    </div>
                    
                    <!-- –û–ø–∏—Å–∞–Ω–∏–µ -->
                    {% if bookmark.fanfic.description %}
                    <p class="story-description">{{ bookmark.fanfic.description|truncatewords:30 }}</p>
                    {% elif bookmark.fanfic.summary %}
                    <p class="story-description">{{ bookmark.fanfic.summary|truncatewords:30 }}</p>
                    {% endif %}
                    
                    <!-- –¢–µ–≥–∏ -->
                    {% if bookmark.fanfic.tags %}
                    <div class="story-tags mb-3">
                        {% for tag in bookmark.fanfic.get_tags_list %}
                            {% if tag %}
                                {% with tag_slug=tag|slugify %}
                                    {% if tag_slug %}
                                        <a href="{% url 'tag_detail' tag_slug %}" class="tag">{{ tag }}</a>
                                    {% else %}
                                        <span class="tag">{{ tag }}</span>
                                    {% endif %}
                                {% endwith %}
                            {% endif %}
                        {% endfor %}
                    </div>
                    {% endif %}
                    
                    <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
                    <div class="bookmark-actions">
                        <div>
                            <a href="{% url 'fanfic_detail' bookmark.fanfic.pk %}" class="btn btn-read me-2">
                                <i class="bi bi-book"></i> –ß–∏—Ç–∞—Ç—å
                            </a>
                            <form method="post" action="{% url 'remove_bookmark' bookmark.id %}" class="d-inline">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-sm remove-bookmark-btn">
                                    <i class="bi bi-bookmark-x"></i> –£–¥–∞–ª–∏—Ç—å
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
                {% endfor %}
                
                <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
                {% if page_obj.paginator.num_pages > 1 %}
                <nav aria-label="–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º" class="mt-4">
                    <ul class="pagination justify-content-center">
                        {% if page_obj.has_previous %}
                        <li class="page-item">
                            <a class="page-link" href="?page=1">&laquo; –ü–µ—Ä–≤–∞—è</a>
                        </li>
                        <li class="page-item">
                            <a class="page-link" href="?page={{ page_obj.previous_page_number }}">–ù–∞–∑–∞–¥</a>
                        </li>
                        {% endif %}
                        
                        {% for num in page_obj.paginator.page_range %}
                            {% if page_obj.number == num %}
                            <li class="page-item active">
                                <span class="page-link">{{ num }}</span>
                            </li>
                            {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                            <li class="page-item">
                                <a class="page-link" href="?page={{ num }}">{{ num }}</a>
                            </li>
                            {% endif %}
                        {% endfor %}
                        
                        {% if page_obj.has_next %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ page_obj.next_page_number }}">–í–ø–µ—Ä–µ–¥</a>
                        </li>
                        <li class="page-item">
                            <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}">–ü–æ—Å–ª–µ–¥–Ω—è—è &raquo;</a>
                        </li>
                        {% endif %}
                    </ul>
                </nav>
                {% endif %}
                
                {% endif %}
            </div>
        </div>
    </div>
</section>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—á–∏—Å—Ç–∫–∏ -->
{% if total_bookmarks > 0 %}
<div class="modal fade" id="clearModal" tabindex="-1" aria-labelledby="clearModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="clearModalLabel">
                    <i class="bi bi-exclamation-triangle me-2 text-danger"></i>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p class="fw-bold">–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ –∑–∞–∫–ª–∞–¥–∫–∏?</p>
                <p class="text-muted"><small>–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ —É–¥–∞–ª–∏—Ç –≤—Å–µ {{ total_bookmarks }} —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —Ñ–∞–Ω—Ñ–∏–∫–æ–≤ –∏–∑ –∑–∞–∫–ª–∞–¥–æ–∫.</small></p>
                <p class="text-muted"><small>–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.</small></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                <form method="post" action="{% url 'clear_bookmarks' %}">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger">–î–∞, —É–¥–∞–ª–∏—Ç—å –≤—Å–µ</button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}