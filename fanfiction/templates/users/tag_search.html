{% extends 'base.html' %}
{% load static %}

{% block title %}–ü–æ–∏—Å–∫ –ø–æ —Ç–µ–≥–∞–º - –§–∞–Ω—Ñ–∏—Ç–∞—Å—Ç–∏–∫–∞{% endblock %}

{% block content %}
<section class="py-3 py-md-5 mobile-padding">
    <div class="container-fluid">
        <div class="row justify-content-center">
            <div class="col-12 col-md-10">
                
                <!-- –§–æ—Ä–º–∞ –ø–æ–∏—Å–∫–∞ (—Ç–æ—á–Ω–æ –∫–∞–∫ –≤ –≤–∞—à–µ–º –ø—Ä–∏–º–µ—Ä–µ) -->
                <div class="card mb-4" style="border: 2px solid #453518; border-radius: 12px;">
                    <div class="card-header" style="background-color: #453518; color: #fdf6e3; padding: 1.5rem; border-radius: 12px 12px 0 0; border-bottom: none;">
                        <h4 class="mb-0">üîç –ü–æ–∏—Å–∫ –ø–æ —Ç–µ–≥–∞–º</h4>
                    </div>
                    <div class="card-body" style="padding: 1.5rem;">
                        <form action="{% url 'tag_search' %}" method="get">
                            <div class="mb-4">
                                <label class="form-label fw-bold" style="color: #453518;">–í–≤–µ–¥–∏—Ç–µ —Ç–µ–≥–∏ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é:</label>
                                <input type="text" 
                                       class="form-control" 
                                       name="q" 
                                       placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: —Ä–æ–º–∞–Ω—Ç–∏–∫–∞, –¥—Ä–∞–º–∞, —Ñ—ç–Ω—Ç–µ–∑–∏"
                                       value="{{ query|default:'' }}"
                                       style="border: 2px solid #eddcae; border-radius: 8px; padding: 0.75rem; font-size: 1rem; transition: all 0.3s ease;">
                                <div class="form-text" style="color: #7d6b4f; font-size: 0.9rem; margin-top: 0.5rem;">
                                    üí° –ù–∞–π–¥–µ—Ç —Ñ–∞–Ω—Ñ–∏–∫–∏, —Å–æ–¥–µ—Ä–∂–∞—â–∏–µ –ª—é–±–æ–π –∏–∑ —É–∫–∞–∑–∞–Ω–Ω—ã—Ö —Ç–µ–≥–æ–≤
                                </div>
                            </div>
                            <div class="d-grid">
                                <button type="submit" class="btn" 
                                        style="background: #453518; color: #fdf6e3; border: none; padding: 0.75rem; border-radius: 8px; font-weight: 600; transition: all 0.3s ease; width: 100%;">
                                    üîç –ù–∞–π—Ç–∏ —Ñ–∞–Ω—Ñ–∏–∫–∏
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ -->
                {% if tags_list %}
                <!-- –®–∞–ø–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (–∫–∞–∫ –≤ –≤–∞—à–µ–º –ø—Ä–∏–º–µ—Ä–µ) -->
                <div class="card mb-4" style="border: 2px solid #453518; border-radius: 12px;">
                    <div class="card-header" style="background-color: #453518; color: white;">
                        <div class="d-flex justify-content-between align-items-center flex-wrap">
                            <div>
                                <h4 class="mb-2">üîç –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞</h4>
                                <div class="d-flex flex-wrap align-items-center gap-2 mt-2">
                                    {% for tag in tags_list %}
                                    <span class="badge" style="background-color: #eddcae; color: #453518;">
                                        {{ tag }}
                                    </span>
                                    {% endfor %}
                                    <span class="badge" style="background-color: #7d6b4f; color: white;">
                                        –õ—é–±–æ–π —Ç–µ–≥
                                    </span>
                                </div>
                            </div>
                            <a href="{% url 'tag_search' %}" class="btn btn-sm mt-2 mt-md-0" 
                               style="background-color: #eddcae; color: #453518; border: none;">
                                –ù–æ–≤—ã–π –ø–æ–∏—Å–∫
                            </a>
                        </div>
                    </div>
                    <div class="card-body">
                        <!-- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ -->
                        <div class="alert mb-0" style="background-color: #eddcae; border: 2px solid #453518; color: #453518;">
                            <h5 class="mb-2">–ù–∞–π–¥–µ–Ω–æ —Ñ–∞–Ω—Ñ–∏–∫–æ–≤: {{ fanfics_count }}</h5>
                            <p class="mb-0">
                                –§–∞–Ω—Ñ–∏–∫–∏, —Å–æ–¥–µ—Ä–∂–∞—â–∏–µ <strong>–ª—é–±–æ–π</strong> –∏–∑ —É–∫–∞–∑–∞–Ω–Ω—ã—Ö —Ç–µ–≥–æ–≤
                            </p>
                        </div>
                    </div>
                </div>

                <!-- –°–ø–∏—Å–æ–∫ —Ñ–∞–Ω—Ñ–∏–∫–æ–≤ (—Ç–æ—á–Ω–æ –∫–∞–∫ –≤ –Ω–æ–≤—ã—Ö —Ñ–∞–Ω—Ñ–∏–∫–∞—Ö) -->
                {% if fanfics %}
                <h2 class="h2 mb-4 text-center" style="color: #453518;">üìö –ù–∞–π–¥–µ–Ω–Ω—ã–µ —Ñ–∞–Ω—Ñ–∏–∫–∏</h2>
                
                {% for fanfic in fanfics %}
                <div class="story-card mb-4">
                    <h3 class="story-title">{{ fanfic.title }}</h3>
                    
                    <!-- –ê–≤—Ç–æ—Ä –∏ –¥–∞—Ç–∞ -->
                    <div class="story-author mb-2">–ê–≤—Ç–æ—Ä: {{ fanfic.author.username }}</div>
                    
                    <!-- –°—á–µ—Ç—á–∏–∫ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ -->
                    <div class="d-flex gap-3 mb-3 text-muted" style="font-size: 0.9rem;">
                        <span>
                            <i class="bi bi-eye"></i> {{ fanfic.views_count }} –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤
                        </span>
                        <span>
                            <i class="bi bi-calendar"></i> {{ fanfic.created_at|date:"d.m.Y" }}
                        </span>
                    </div>
                    
                    <!-- –û–ø–∏—Å–∞–Ω–∏–µ -->
                    {% if fanfic.description %}
                    <p class="story-description">{{ fanfic.description|truncatewords:30 }}</p>
                    {% elif fanfic.summary %}
                    <p class="story-description">{{ fanfic.summary|truncatewords:30 }}</p>
                    {% endif %}
                    
                    <!-- –¢–µ–≥–∏ -->
                    {% if fanfic.tags %}
                    <div class="story-tags mb-3">
                        {% for tag in fanfic.get_tags_list %}
                            {% if tag %}
                                {% with tag_slug=tag|slugify %}
                                    {% if tag_slug %}
                                        <a href="{% url 'tag_detail' tag_slug %}" class="tag">
                                            {{ tag }}
                                        </a>
                                    {% else %}
                                        <span class="tag">{{ tag }}</span>
                                    {% endif %}
                                {% endwith %}
                            {% endif %}
                        {% endfor %}
                    </div>
                    {% endif %}
                    
                    <!-- –§—É—Ç–µ—Ä —Å –∫–Ω–æ–ø–∫–æ–π —Å–ø—Ä–∞–≤–∞ -->
                    <div class="story-footer d-flex justify-content-between align-items-center">
                        <small class="story-date text-muted">{{ fanfic.created_at|date:"d.m.Y" }}</small>
                        <a href="{% url 'fanfic_detail' fanfic.pk %}" class="btn btn-read">–ß–∏—Ç–∞—Ç—å</a>
                    </div>
                </div>
                {% endfor %}
                
                {% else %}
                <!-- –ü—É—Å—Ç—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
                <div class="text-center py-5">
                    <h4 class="h4 mb-3" style="color: #453518;">üòî –ù–µ –Ω–∞–π–¥–µ–Ω–æ —Ñ–∞–Ω—Ñ–∏–∫–æ–≤</h4>
                    <p class="text-muted mb-4">
                        –ü–æ —Ç–µ–≥–∞–º <strong>{{ tags_list|join:", " }}</strong> –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
                    </p>
                    
                    <div class="mb-4">
                        <p class="text-dark mb-3 fw-bold">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ:</p>
                        <ul class="text-start d-inline-block text-center" style="list-style: none; padding: 0; max-width: 400px;">
                            <li class="mb-2">‚Ä¢ –£–±—Ä–∞—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Ç–µ–≥–∏</li>
                            <li class="mb-2">‚Ä¢ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ø–∏—Å–∞–Ω–∏–µ —Ç–µ–≥–æ–≤</li>
                            <li class="mb-2">‚Ä¢ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ–Ω–µ–µ —Å—Ç—Ä–æ–≥–∏–π –ø–æ–∏—Å–∫</li>
                            <li class="mb-2">‚Ä¢ –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–µ–≥–∏</li>
                        </ul>
                    </div>
                    
                    <div class="mt-4">
                        <a href="{% url 'tag_search' %}" class="btn me-2 mb-2" 
                           style="background-color: #453518; color: white; border: none;">
                            üîç –ù–æ–≤—ã–π –ø–æ–∏—Å–∫
                        </a>
                        <a href="{% url 'all_tags' %}" class="btn mb-2" 
                           style="background-color: #eddcae; color: #453518; border: 2px solid #453518;">
                            üè∑Ô∏è –í—Å–µ —Ç–µ–≥–∏
                        </a>
                    </div>
                </div>
                {% endif %}
                
                {% else %}
                <!-- –ü–æ–¥—Å–∫–∞–∑–∫–∞ –ø–µ—Ä–µ–¥ –ø–æ–∏—Å–∫–æ–º -->
                <div class="text-center py-5">
                    <div class="mb-4">
                        <i class="bi bi-search" style="font-size: 3rem; color: #453518; margin-bottom: 1rem;"></i>
                        <h4 class="h4 mb-3" style="color: #453518;">–ù–∞—á–Ω–∏—Ç–µ –ø–æ–∏—Å–∫</h4>
                        <p class="text-muted mb-4">
                            –í–≤–µ–¥–∏—Ç–µ —Ç–µ–≥–∏ –≤ –ø–æ–ª–µ –≤—ã—à–µ, —á—Ç–æ–±—ã –Ω–∞–π—Ç–∏ –∏–Ω—Ç–µ—Ä–µ—Å—É—é—â–∏–µ –≤–∞—Å —Ñ–∞–Ω—Ñ–∏–∫–∏
                        </p>
                    </div>
                    
                    <div class="mb-4">
                        <p class="text-dark mb-3 fw-bold">–ü—Ä–∏–º–µ—Ä—ã –ø–æ–∏—Å–∫–∞:</p>
                        <ul class="text-start d-inline-block text-center" style="list-style: none; padding: 0; max-width: 500px;">
                            <li class="mb-2">‚Ä¢ "—Ä–æ–º–∞–Ω—Ç–∏–∫–∞, —Ñ—ç–Ω—Ç–µ–∑–∏" - –Ω–∞–π–¥–µ—Ç —Ñ–∞–Ω—Ñ–∏–∫–∏ —Å —Ä–æ–º–∞–Ω—Ç–∏–∫–æ–π –ò–õ–ò —Ñ—ç–Ω—Ç–µ–∑–∏</li>
                            <li class="mb-2">‚Ä¢ "–¥—Ä–∞–º–∞, —à–∫–æ–ª—å–Ω–∞—è –∂–∏–∑–Ω—å"</li>
                            <li class="mb-2">‚Ä¢ "–ø—Ä–∏–∫–ª—é—á–µ–Ω–∏—è, —é–º–æ—Ä, –∫–æ–º–µ–¥–∏—è"</li>
                        </ul>
                    </div>
                    
                    <div class="mt-4">
                        <a href="{% url 'all_tags' %}" class="btn" 
                           style="background-color: #453518; color: white; border: none;">
                            üè∑Ô∏è –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ —Ç–µ–≥–∏
                        </a>
                    </div>
                </div>
                {% endif %}
                
            </div>
        </div>
    </div>
</section>
{% endblock %}