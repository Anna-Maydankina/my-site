{% extends 'base.html' %}

{% block content %}
<section class="py-3 py-md-5 mobile-padding">
    <div class="container-fluid">
        <div class="row justify-content-center">
            <div class="col-12 col-md-10">
                <!-- –®–∞–ø–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞ -->
                <div class="card mb-4" style="border: 2px solid #453518; border-radius: 12px;">
                    <div class="card-header" style="background-color: #453518; color: white;">
                        <div class="d-flex justify-content-between align-items-center flex-wrap">
                            <div>
                                <h4 class="mb-2">üîç –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞</h4>
                                <div class="d-flex flex-wrap align-items-center gap-2 mt-2">
                                    {% for tag in tags_list %}
                                    <span class="badge" style="background-color: #eddcae; color: #453518;">
                                        {{ tag }}
                                    </span>
                                    {% endfor %}
                                    <span class="badge" style="background-color: #7d6b4f; color: white;">
                                        {% if search_type == 'all' %}–í—Å–µ —Ç–µ–≥–∏{% else %}–õ—é–±–æ–π —Ç–µ–≥{% endif %}
                                    </span>
                                </div>
                            </div>
                            <a href="{% url 'tag_search' %}" class="btn btn-sm mt-2 mt-md-0" 
                               style="background-color: #eddcae; color: #453518; border: none;">
                                –ù–æ–≤—ã–π –ø–æ–∏—Å–∫
                            </a>
                        </div>
                    </div>
                    <div class="card-body">
                        <!-- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ -->
                        <div class="alert mb-0" style="background-color: #eddcae; border: 2px solid #453518; color: #453518;">
                            <h5 class="mb-2">–ù–∞–π–¥–µ–Ω–æ —Ñ–∞–Ω—Ñ–∏–∫–æ–≤: {{ fanfics_count }}</h5>
                            <p class="mb-0">
                                {% if search_type == 'all' %}
                                –§–∞–Ω—Ñ–∏–∫–∏, —Å–æ–¥–µ—Ä–∂–∞—â–∏–µ <strong>–≤—Å–µ</strong> —É–∫–∞–∑–∞–Ω–Ω—ã–µ —Ç–µ–≥–∏
                                {% else %}
                                –§–∞–Ω—Ñ–∏–∫–∏, —Å–æ–¥–µ—Ä–∂–∞—â–∏–µ <strong>–ª—é–±–æ–π</strong> –∏–∑ —É–∫–∞–∑–∞–Ω–Ω—ã—Ö —Ç–µ–≥–æ–≤
                                {% endif %}
                            </p>
                        </div>
                    </div>
                </div>

                <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
                {% if fanfics %}
                <h2 class="h2 mb-4 text-center" style="color: #453518;">
                    üìö –ù–∞–π–¥–µ–Ω–Ω—ã–µ —Ñ–∞–Ω—Ñ–∏–∫–∏
                </h2>
                
                {% for fanfic in fanfics %}
                <div class="story-card mb-4">
                    <h3 class="story-title">{{ fanfic.title }}</h3>
                    
                    <!-- –ê–≤—Ç–æ—Ä -->
                    <div class="story-author mb-2">–ê–≤—Ç–æ—Ä: {{ fanfic.author.username }}</div>
                    
                    <!-- –°—á–µ—Ç—á–∏–∫ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ -->
                    <div class="d-flex gap-3 mb-3 text-muted" style="font-size: 0.9rem;">
                        <span>
                            <i class="bi bi-eye"></i> {{ fanfic.views_count }} –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤
                        </span>
                        <span>
                            <i class="bi bi-calendar"></i> {{ fanfic.created_at|date:"d.m.Y" }}
                        </span>
                    </div>
                    
                    <!-- –û–ø–∏—Å–∞–Ω–∏–µ -->
                    {% if fanfic.description %}
                    <p class="story-description">{{ fanfic.description|truncatewords:40 }}</p>
                    {% endif %}
                    
                    <!-- –¢–µ–≥–∏ —Ñ–∞–Ω—Ñ–∏–∫–∞ -->
                    {% if fanfic.tags %}
                    <div class="story-tags mb-3">
                        {% for tag in fanfic.get_tags_list %}
                            {% if tag %}
                                {% with tag_slug=tag|slugify %}
                                    {% if tag_slug %}
                                        <a href="{% url 'tag_detail' tag_slug %}" 
                                           class="tag {% if tag in tags_list %}" 
                                           style="background: #453518 !important; color: #fdf6e3 !important; font-weight: bold;"{% endif %}>
                                            {{ tag }}
                                        </a>
                                    {% else %}
                                        <span class="tag {% if tag in tags_list %}" 
                                              style="background: #453518 !important; color: #fdf6e3 !important; font-weight: bold;"{% endif %}>
                                            {{ tag }}
                                        </span>
                                    {% endif %}
                                {% endwith %}
                            {% endif %}
                        {% endfor %}
                    </div>
                    {% endif %}
                    
                    <!-- –§—É—Ç–µ—Ä —Å –∫–Ω–æ–ø–∫–æ–π —Å–ø—Ä–∞–≤–∞ -->
                    <div class="story-footer d-flex justify-content-between align-items-center">
                        <small class="story-date text-muted">{{ fanfic.created_at|date:"d.m.Y" }}</small>
                        <a href="{% url 'fanfic_detail' fanfic.pk %}" class="btn btn-read">–ß–∏—Ç–∞—Ç—å</a>
                    </div>
                </div>
                {% endfor %}
                
                {% else %}
                <!-- –ü—É—Å—Ç—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
                <div class="text-center py-5">
                    <h4 class="h4 mb-3" style="color: #453518;">üòî –ù–µ –Ω–∞–π–¥–µ–Ω–æ —Ñ–∞–Ω—Ñ–∏–∫–æ–≤</h4>
                    <p class="text-muted mb-4">
                        {% if search_type == 'all' %}
                        –ù–µ—Ç —Ñ–∞–Ω—Ñ–∏–∫–æ–≤, —Å–æ–¥–µ—Ä–∂–∞—â–∏—Ö –≤—Å–µ —É–∫–∞–∑–∞–Ω–Ω—ã–µ —Ç–µ–≥–∏
                        {% else %}
                        –ù–µ—Ç —Ñ–∞–Ω—Ñ–∏–∫–æ–≤ —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º–∏ —Ç–µ–≥–∞–º–∏
                        {% endif %}
                    </p>
                    
                    <div class="mb-4">
                        <p class="text-dark mb-3 fw-bold">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ:</p>
                        <ul class="text-start d-inline-block text-center" style="list-style: none; padding: 0; max-width: 400px;">
                            <li class="mb-2">‚Ä¢ –£–±—Ä–∞—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Ç–µ–≥–∏</li>
                            <li class="mb-2">‚Ä¢ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ø–∏—Å–∞–Ω–∏–µ —Ç–µ–≥–æ–≤</li>
                            <li class="mb-2">‚Ä¢ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å {% if search_type == 'all' %}–ø–æ–∏—Å–∫ –ø–æ –ª—é–±–æ–º—É —Ç–µ–≥—É{% else %}–ø–æ–∏—Å–∫ –ø–æ –≤—Å–µ–º —Ç–µ–≥–∞–º{% endif %}</li>
                        </ul>
                    </div>
                    
                    <div class="mt-4">
                        <a href="{% url 'tag_search' %}" class="btn me-2 mb-2" 
                           style="background-color: #453518; color: white; border: none;">
                            üîç –ù–æ–≤—ã–π –ø–æ–∏—Å–∫
                        </a>
                        <a href="{% url 'all_tags' %}" class="btn mb-2" 
                           style="background-color: #eddcae; color: #453518; border: 2px solid #453518;">
                            üè∑Ô∏è –í—Å–µ —Ç–µ–≥–∏
                        </a>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</section>
{% endblock %}